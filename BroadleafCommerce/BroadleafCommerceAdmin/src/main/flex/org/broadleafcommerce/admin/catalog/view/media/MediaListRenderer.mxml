<?xml version="1.0" encoding="utf-8"?>
<!--
/*
 * Copyright 2008-2009 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
 -->
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%">
	

<mx:Script>
	<![CDATA[
		import org.broadleafcommerce.admin.catalog.control.events.media.ShowFileUploadEvent;
		import org.broadleafcommerce.admin.core.model.ConfigModel;
		import mx.utils.ObjectUtil;
		import mx.events.FlexEvent;
		import mx.events.ListEventReason;
		import mx.events.ListEvent;
		import org.broadleafcommerce.admin.catalog.vo.media.Media;
		import org.broadleafcommerce.admin.core.vo.tools.CodeType;
		import mx.collections.ArrayCollection;
		import org.broadleafcommerce.admin.core.model.AppModelLocator;
		import org.broadleafcommerce.admin.core.model.AdminToolsModel;

	[Bindable]
	private var configModel:ConfigModel = AppModelLocator.getInstance().configModel;

	[Bindable]
	public var editedData:Media = null;

	private function handleUploadClick(event:Event):void{
		//currentState = "EDIT";
		var sfue:ShowFileUploadEvent = new ShowFileUploadEvent("",this.editedData);
		sfue.dispatch();
	}		
	
	private function selectCurrentCodeType(key:String):int{
		if(keyTextBox.dataProvider != null && keyTextBox.dataProvider is ArrayCollection){
			var x:int =  0;
			for each(var codeType:CodeType in ArrayCollection(keyTextBox.dataProvider)){
				if(codeType.key == key){
					return x;
				}
				x++;
			}
		}
		return -1;
	}
	
	public function handleEdit():void{
		currentState = "EDIT";
	}
	
	private function handleSave():void{
		if(keyTextBox.selectedIndex > 0 &&
		   nameLabelEdit.text != "" &&
		   labelLabelEdit.text != "" &&
		   urlLabelEdit.text != ""){		   	
			var mediaData:Media = Media(data);
			mediaData.key = keyTextBox.selectedItem.key;
			mediaData.name = nameLabelEdit.text;
			mediaData.label = labelLabelEdit.text;
			mediaData.url = urlLabelEdit.text;	
			currentState = "DISPLAY";
		   }
	}
	
	private function handleCancel():void{
		currentState = "DISPLAY";
	}
	
	]]>
</mx:Script>

	<mx:Binding source="data.key"
	            destination="keyText.text" />
	<mx:Binding source="data.url"
	            destination="urlLabel.text" />
	<mx:Binding source="configModel.urlServer+data.url"
	            destination="thumbnail.source" />
	<mx:Binding source="data.name" 
		        destination="nameLabel.text"/>
	<mx:Binding source="data.label" 
		        destination="labelLabel.text"/>
	<mx:Binding source="configModel.currentCodeTypes"
	            destination="keyTextBox.dataProvider" />	
	<mx:Binding source="configModel.urlServer+urlLabelEdit.text"
	            destination="thumbnailEdit.source" />            

	<mx:Binding source="selectCurrentCodeType(editedData.key)"
	            destination="keyTextBox.selectedIndex" />
	<mx:Binding source="editedData.url"
	            destination="urlLabelEdit.text" />
	<mx:Binding source="editedData.name"
	            destination="nameLabelEdit.text" />
	<mx:Binding source="editedData.label"
				destination="labelLabelEdit.text" />	            

		        
	<mx:Canvas id="displayCanvas" width="100%" >		
		<mx:HBox width="100%">
			<mx:VBox>
				<mx:Image id="thumbnail" maxHeight="75" maxWidth="75" maintainAspectRatio="true" 
					horizontalAlign="center" horizontalCenter="0" y="27" width="75" height="75"/>
			</mx:VBox>
		<mx:VBox>
			<mx:HBox>
				
			<mx:VBox>
				<mx:HBox>
					<mx:Text width="50" text="Name:" /><mx:Text id="nameLabel"  y="0" x="40" width="100"/>				
				</mx:HBox>
				<mx:HBox>
					<mx:Text width="50" text="Label:"  x="2" y="23"/> <mx:Text id="labelLabel" width="100"  y="23" x="40"/>					
				</mx:HBox>
			</mx:VBox>
			<mx:VBox>				
				<mx:Text id="keyText" />
				<mx:Button id="editButton" label="Edit" visible="false" click="handleEdit()"/>
			</mx:VBox>
			</mx:HBox>
			<mx:HBox>
				<mx:Text text="URL:"  y="45" x="10"/>	<mx:Text id="urlLabel"  y="45" x="40"/>				
			</mx:HBox>
			</mx:VBox>
		</mx:HBox>
	</mx:Canvas>
	<mx:Canvas id="editCanvas" visible="false" width="100%" >		
	<mx:HBox width="100%">
		<mx:VBox>
			<mx:Image id="thumbnailEdit" maxHeight="75" maxWidth="75" maintainAspectRatio="true" 
				horizontalAlign="center" horizontalCenter="0" y="27" width="75" height="75"/>
			<mx:LinkButton x="10" y="4" label="Upload" horizontalCenter="0" click="handleUploadClick(event)"/>			
		</mx:VBox>
		<mx:VBox>
		 <mx:HBox>		 	
			<mx:VBox>				
				<mx:HBox>
					<mx:Text width="50" text="Name:" /><mx:TextInput id="nameLabelEdit" width="100" y="0" x="40"/>				
				</mx:HBox>
				<mx:HBox>
					<mx:Text width="50" text="Label:"  x="2" y="23"/>	<mx:TextInput id="labelLabelEdit" width="100"  y="23" x="40"/>				
				</mx:HBox>
			</mx:VBox>
			<mx:VBox>
				<mx:ComboBox id="keyTextBox" labelField="key" />
				<mx:HBox>					
					<mx:Button id="saveButton" label="Save" click="handleSave()"/>
					<mx:Button id="cancelButton" label="Cancel" click="handleCancel()" />			
				</mx:HBox>
			</mx:VBox>
		 </mx:HBox>
			<mx:HBox>
				<mx:Text text="URL:"  y="45" x="10"/> <mx:Text id="urlLabelEdit"  y="45" x="40"/>					
			</mx:HBox>
		</mx:VBox>
	</mx:HBox>
	</mx:Canvas>

	<mx:states>
		<mx:State name="DISPLAY">
			<mx:SetProperty target="{editCanvas}" name="visible" value="false" />
			<mx:SetProperty target="{displayCanvas}" name="visible" value="true" />
		</mx:State>
		<mx:State name="EDIT">
			<mx:SetProperty target="{editCanvas}" name="visible" value="true" />
			<mx:SetProperty target="{displayCanvas}" name="visible" value="false" />
			<mx:enterState>
				<![CDATA[
					editedData = Media(ObjectUtil.copy(data));
				]]>
			</mx:enterState>
					
		</mx:State>
	</mx:states>

</mx:Canvas>
