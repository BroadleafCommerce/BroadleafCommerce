<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
	 width="100%" 
	 height="100%"
	 applicationComplete="initApp()" 
	 layout="absolute"
	 xmlns:business="org.broadleafcommerce.admin.core.business.*" 
	 xmlns:control="org.broadleafcommerce.admin.core.control.*" 
	 xmlns:view="org.broadleafcommerce.admin.core.view.*" 
	 xmlns:local="*"
	 currentState="app_anonymous_state"> 
	
	<mx:Script>
		<![CDATA[
			import org.broadleafcommerce.admin.core.model.AppModelLocator;
			import org.broadleafcommerce.admin.core.model.AuthenticationModel;
			import org.broadleafcommerce.admin.core.control.events.InitializeApplicationEvent;
			import com.adobe.cairngorm.control.CairngormEventDispatcher;
			
			[Bindable]
			private var authModel:AuthenticationModel = AppModelLocator.getInstance().authModel;
			
			private function initApp():void{
				AppModelLocator.getInstance().configModel.urlPrefix = Application.application.loaderInfo.url.substr(0,
			                                          	  Application.application.loaderInfo.url.lastIndexOf("/"))+"/";
				var iae:InitializeApplicationEvent = new InitializeApplicationEvent();
				CairngormEventDispatcher.getInstance().dispatchEvent(iae);
			}
		]]>
	</mx:Script>
	
	<mx:Style source="/assets/styles/broadleafcommerceadmin.css" />
	
	<mx:Binding source="authModel.authenticatedState"
	                   destination="this.currentState" /> 
		
	<control:BlcAdminController />
	<business:BlcAdminServices />
	
	<view:LoginCanvas id="loginCanvas" width="100%" height="100%" visible="true" x="0" y="0" />
	
	<local:ApplicationCanvas id="applicationCanvas" width="100%" height="100%" visible="false" x="0" y="0" />
	
	<mx:Text x="10" y="470" width="858" id="testText" visible="true"  height="185"/>	

	<mx:states>
		<mx:State name="{AuthenticationModel.STATE_APP_ANONYMOUS}" >
			<mx:SetProperty target="{loginCanvas}" name="visible" value="true" />
			<mx:SetProperty target="{applicationCanvas}" name="visible" value="false" />
		</mx:State>
		<mx:State name="{AuthenticationModel.STATE_APP_AUTHENTICATED}" >
			<mx:SetProperty target="{loginCanvas}" name="visible" value="false" />
			<mx:SetProperty target="{applicationCanvas}" name="visible" value="true" />
		</mx:State>
	</mx:states>
</mx:Application>
